@page "/api-calls"

<PageTitle>API-kald fra Frontend - H2 Studieplan</PageTitle>

<div class="api-calls-container">
    <div class="api-header">
        <h1 class="api-title">
            <i class="fas fa-exchange-alt"></i>
            API-kald fra Frontend
        </h1>
        <p class="api-subtitle">Forstå kommunikation mellem klient og server</p>
    </div>

    <!-- Hvad er API-kald? -->
    <div class="content-section">
        <h2><i class="fas fa-question-circle"></i> Hvad er API-kald?</h2>
        <div class="explanation-card">
            <p>
                <strong>API (Application Programming Interface)</strong> er en måde for forskellige programmer at kommunikere med hinanden. 
                Fra et frontend perspektiv er API-kald som at sende beskeder til en server og få svar tilbage.
            </p>
            
            <div class="api-flow">
                <div class="flow-step">
                    <div class="step-icon client">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <h4>1. Frontend (Klient)</h4>
                    <p>Din Blazor app sender en forespørgsel</p>
                </div>
                
                <div class="flow-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                
                <div class="flow-step">
                    <div class="step-icon server">
                        <i class="fas fa-server"></i>
                    </div>
                    <h4>2. Backend (Server)</h4>
                    <p>Opgaver API'en behandler forespørgslen</p>
                </div>
                
                <div class="flow-arrow">
                    <i class="fas fa-arrow-left"></i>
                </div>
                
                <div class="flow-step">
                    <div class="step-icon response">
                        <i class="fas fa-reply"></i>
                    </div>
                    <h4>3. Svar</h4>
                    <p>Data sendes tilbage til din app</p>
                </div>
            </div>
        </div>
    </div>

    <!-- HTTP Metoder -->
    <div class="content-section">
        <h2><i class="fas fa-tools"></i> HTTP Metoder</h2>
        <p>
            De fire vigtigste HTTP-metoder svarer til CRUD-principperne:
            <strong>Create (POST)</strong>, <strong>Read (GET)</strong>, <strong>Update (PUT)</strong> og <strong>Delete (DELETE)</strong>.<br />
            CRUD beskriver de grundlæggende operationer, man kan udføre på data i et system.
        </p>
       
        <div class="methods-main-grid">
            <div class="method-card get">
                <div class="method-header">
                    <span class="method-badge">GET</span>
                    <h4>Read (Hent Data)</h4>
                </div>
                <p>CRUD: <strong>Read</strong></p>
                <p>Bruges til at hente information fra serveren. Ændrer ikke data.</p>
                <div class="code-example">
                    <code>GET /api/opgaver</code>
                </div>
            </div>
            <div class="method-card post">
                <div class="method-header">
                    <span class="method-badge">POST</span>
                    <h4>Create (Opret Data)</h4>
                </div>
                <p>CRUD: <strong>Create</strong></p>
                <p>Bruges til at oprette nye ressourcer på serveren.</p>
                <div class="code-example">
                    <code>POST /api/opgaver</code>
                </div>
            </div>
            <div class="method-card put">
                <div class="method-header">
                    <span class="method-badge">PUT</span>
                    <h4>Update (Opdater Data)</h4>
                </div>
                <p>CRUD: <strong>Update</strong></p>
                <p>Bruges til at opdatere eksisterende ressourcer.</p>
                <div class="code-example">
                    <code>PUT /api/opgaver/{id}</code>
                </div>
            </div>
            <div class="method-card delete">
                <div class="method-header">
                    <span class="method-badge">DELETE</span>
                    <h4>Delete (Slet Data)</h4>
                </div>
                <p>CRUD: <strong>Delete</strong></p>
                <p>Bruges til at slette ressourcer fra serveren.</p>
                <div class="code-example">
                    <code>DELETE /api/opgaver/{id}</code>
                </div>
            </div>
        </div>
        <div class="methods-other-grid">
            <div class="method-card other patch">
                <span class="method-badge">PATCH</span>
                <h4>Opdater delvist</h4>
                <p>Opdaterer dele af en ressource</p>
            </div>
            <div class="method-card other head">
                <span class="method-badge">HEAD</span>
                <h4>Header forespørgsel</h4>
                <p>Henter kun headers, ikke selve dataen</p>
            </div>
            <div class="method-card other options">
                <span class="method-badge">OPTIONS</span>
                <h4>Metode muligheder</h4>
                <p>Spørger serveren hvilke metoder der er tilladt</p>
            </div>
            <div class="method-card other trace">
                <span class="method-badge">TRACE</span>
                <h4>Fejlfinding</h4>
                <p>Bruges til fejlfinding</p>
            </div>
            <!-- Tilføj flere hvis ønsket -->
        </div>
    </div>

    <!-- HTTP Status Koder -->
    <div class="content-section">
        <h2><i class="fas fa-traffic-light"></i> HTTP Status Koder</h2>
        <p class="section-intro">Status koder fortæller dig hvordan din forespørgsel gik. Her er de vigtigste:</p>
        
        <div class="status-categories">
            <!-- 2xx Success -->
            <div class="status-category success">
                <h3><i class="fas fa-check-circle"></i> 2xx - Success (Alt gik godt!)</h3>
                <div class="status-codes">
                    <div class="status-code">
                        <span class="code">200</span>
                        <div class="code-info">
                            <h4>OK</h4>
                            <p>Forespørgslen lykkedes perfekt</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">201</span>
                        <div class="code-info">
                            <h4>Created</h4>
                            <p>Ny ressource blev oprettet</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">204</span>
                        <div class="code-info">
                            <h4>No Content</h4>
                            <p>Succesfuld, men intet indhold at returnere</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4xx Client Error -->
            <div class="status-category client-error">
                <h3><i class="fas fa-exclamation-triangle"></i> 4xx - Client Error (Du lavede en fejl)</h3>
                <div class="status-codes">
                    <div class="status-code">
                        <span class="code">400</span>
                        <div class="code-info">
                            <h4>Bad Request</h4>
                            <p>Din forespørgsel var forkert formateret</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">401</span>
                        <div class="code-info">
                            <h4>Unauthorized</h4>
                            <p>Du skal logge ind først</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">403</span>
                        <div class="code-info">
                            <h4>Forbidden</h4>
                            <p>Du har ikke tilladelse til dette</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">404</span>
                        <div class="code-info">
                            <h4>Not Found</h4>
                            <p>Ressourcen findes ikke</p>
                        </div>
                    </div>
                    <div class="status-code special">
                        <span class="code">418</span>
                        <div class="code-info">
                            <h4>I'm a teapot </h4>
                            <p>Serveren nægter at brygge kaffe, fordi den er en tekande! <i class="fas fa-coffee"></i></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5xx Server Error -->
            <div class="status-category server-error">
                <h3><i class="fas fa-server"></i> 5xx - Server Error (Serveren lavede en fejl)</h3>
                <div class="status-codes">
                    <div class="status-code">
                        <span class="code">500</span>
                        <div class="code-info">
                            <h4>Internal Server Error</h4>
                            <p>Noget gik galt på serveren</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">502</span>
                        <div class="code-info">
                            <h4>Bad Gateway</h4>
                            <p>Serveren fik et dårligt svar fra en anden server</p>
                        </div>
                    </div>
                    <div class="status-code">
                        <span class="code">503</span>
                        <div class="code-info">
                            <h4>Service Unavailable</h4>
                            <p>Serveren er midlertidigt utilgængelig</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HTTPS Sikkerhed -->
    <div class="content-section">
        <h2><i class="fas fa-shield-alt"></i> HTTPS - Sikker Kommunikation</h2>
        <div class="https-explanation">
            <div class="https-comparison">
                <div class="protocol-card insecure">
                    <div class="protocol-header">
                        <i class="fas fa-unlock"></i>
                        <h3>HTTP</h3>
                        <span class="security-badge danger">Usikker</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-times"></i> Data sendes i klartekst</li>
                        <li><i class="fas fa-times"></i> Kan aflæses af andre</li>
                        <li><i class="fas fa-times"></i> Ingen verifikation af server</li>
                        <li><i class="fas fa-times"></i> Sårbar over for angreb</li>
                    </ul>
                </div>

                <div class="vs-divider">
                    <span>VS</span>
                </div>

                <div class="protocol-card secure">
                    <div class="protocol-header">
                        <i class="fas fa-lock"></i>
                        <h3>HTTPS</h3>
                        <span class="security-badge safe">Sikker</span>
                    </div>
                    <ul>
                        <li><i class="fas fa-check"></i> Data krypteres</li>
                        <li><i class="fas fa-check"></i> Kan ikke aflæses af andre</li>
                        <li><i class="fas fa-check"></i> Server verificeres med certifikat</li>
                        <li><i class="fas fa-check"></i> Beskyttet mod angreb</li>
                    </ul>
                </div>
            </div>

            <div class="https-details">
                <h3><i class="fas fa-key"></i> Hvordan virker HTTPS?</h3>
                <div class="encryption-flow">
                    <div class="encryption-step">
                        <div class="step-number">1</div>
                        <h4>Handshake</h4>
                        <p>Klient og server aftaler krypteringsmetode</p>
                    </div>
                    <div class="encryption-step">
                        <div class="step-number">2</div>
                        <h4>Certifikat</h4>
                        <p>Server beviser sin identitet med SSL-certifikat</p>
                    </div>
                    <div class="encryption-step">
                        <div class="step-number">3</div>
                        <h4>Kryptering</h4>
                        <p>Al data krypteres før afsendelse</p>
                    </div>
                    <div class="encryption-step">
                        <div class="step-number">4</div>
                        <h4>Sikker kommunikation</h4>
                        <p>Data kan kun læses af afsender og modtager</p>
                    </div>
                </div>
            </div>

            <div class="https-importance">
                <h3><i class="fas fa-exclamation-circle"></i> Hvorfor er HTTPS vigtigt?</h3>
                <div class="importance-grid">
                    <div class="importance-item">
                        <i class="fas fa-user-shield"></i>
                        <h4>Beskytter brugerdata</h4>
                        <p>Passwords, personlige oplysninger og følsomme data holdes private</p>
                    </div>
                    <div class="importance-item">
                        <i class="fas fa-search"></i>
                        <h4>SEO fordele</h4>
                        <p>Google favoriserer HTTPS-sider i søgeresultater</p>
                    </div>
                    <div class="importance-item">
                        <i class="fas fa-heart"></i>
                        <h4>Brugertillid</h4>
                        <p>Brugere stoler mere på sider med grøn lås-ikon</p>
                    </div>
                    <div class="importance-item">
                        <i class="fas fa-gavel"></i>
                        <h4>Lovkrav</h4>
                        <p>GDPR og andre love kræver sikker databehandling</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Praktisk eksempel -->
    <div class="content-section">
        <h2><i class="fas fa-code"></i> Praktiske Eksempler i Blazor</h2>
        <div class="code-example-section">
            <h3>Sådan laver du API-kald i Blazor:</h3>

            <div class="code-block">
                <h4>GET - Hent data</h4>
                <pre><code class="language-csharp">// Hent alle opgaver
public async Task&lt;List&lt;Opgave&gt;&gt; GetOpgaverAsync()
{
    try
    {
        var response = await _httpClient.GetAsync("https://opgaver.mercantec.tech/api/opgaver");
        if (response.IsSuccessStatusCode)
        {
            var json = await response.Content.ReadAsStringAsync();
            return JsonSerializer.Deserialize&lt;List&lt;Opgave&gt;&gt;(json);
        }
        else
        {
            Console.WriteLine($"Fejl: {response.StatusCode}");
            return new List&lt;Opgave&gt;();
        }
    }
    catch (HttpRequestException ex)
    {
        Console.WriteLine($"Netværksfejl: {ex.Message}");
        return new List&lt;Opgave&gt;();
    }
}
</code></pre>
            </div>

            <div class="code-block">
                <h4>POST - Opret data</h4>
                <pre><code class="language-csharp">// Opret en ny opgave
public async Task&lt;bool&gt; OpretOpgaveAsync(Opgave nyOpgave)
{
    try
    {
        var response = await _httpClient.PostAsJsonAsync("https://opgaver.mercantec.tech/api/opgaver",
         nyOpgave);
        return response.IsSuccessStatusCode;
    }
    catch (HttpRequestException ex)
    {
        Console.WriteLine($"Netværksfejl: {ex.Message}");
        return false;
    }
}
</code></pre>
            </div>

            <div class="code-block">
                <h4>PUT - Opdater data</h4>
                <pre><code class="language-csharp">// Opdater en eksisterende opgave
public async Task&lt;bool&gt; OpdaterOpgaveAsync(int id, Opgave opdateretOpgave)
{
    try
    {
        var response = await _httpClient.PutAsJsonAsync($"https://opgaver.mercantec.tech/api/opgaver/{id}",
         opdateretOpgave);
        return response.IsSuccessStatusCode;
    }
    catch (HttpRequestException ex)
    {
        Console.WriteLine($"Netværksfejl: {ex.Message}");
        return false;
    }
}
</code></pre>
            </div>

            <div class="code-block">
                <h4>DELETE - Slet data</h4>
                <pre><code class="language-csharp">// Slet en opgave
public async Task&lt;bool&gt; SletOpgaveAsync(int id)
{
    try
    {
        var response = await _httpClient.DeleteAsync($"https://opgaver.mercantec.tech/api/opgaver/{id}");
        return response.IsSuccessStatusCode;
    }
    catch (HttpRequestException ex)
    {
        Console.WriteLine($"Netværksfejl: {ex.Message}");
        return false;
    }
}
</code></pre>
            </div>
        </div>
    </div>
</div>

@code
{
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JS.InvokeVoidAsync("PrismHighlight");
        }
    }

    [Inject] IJSRuntime JS { get; set; }
}
